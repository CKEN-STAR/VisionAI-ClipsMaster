{% extends "base.html" %}

{% block title %}VisionAI-ClipsMaster 测试报告{% endblock %}

{% block header_title %}VisionAI-ClipsMaster 测试报告{% endblock %}
{% block header_subtitle %}生成时间: {{ timestamp }}{% endblock %}

{% block content %}
<div class="summary">
    <h2>测试概览</h2>
    <div class="metrics">
        <div class="metric-card">
            <h3>总体得分</h3>
            <div class="metric-value {{ summary.overall_score_class }}">
                {{ summary.overall_score }}%
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ summary.overall_score }}%;"></div>
            </div>
        </div>
        <div class="metric-card">
            <h3>核心功能</h3>
            <div class="metric-value {{ summary.core_score_class }}">
                {{ summary.core_score }}%
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ summary.core_score }}%;"></div>
            </div>
        </div>
        <div class="metric-card">
            <h3>可靠性</h3>
            <div class="metric-value {{ summary.reliability_score_class }}">
                {{ summary.reliability_score }}%
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ summary.reliability_score }}%;"></div>
            </div>
        </div>
        <div class="metric-card">
            <h3>安全性</h3>
            <div class="metric-value {{ summary.security_score_class }}">
                {{ summary.security_score }}%
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ summary.security_score }}%;"></div>
            </div>
        </div>
        <div class="metric-card">
            <h3>用户体验</h3>
            <div class="metric-value {{ summary.usability_score_class }}">
                {{ summary.usability_score }}%
            </div>
            <div class="progress-bar">
                <div class="progress" style="width: {{ summary.usability_score }}%;"></div>
            </div>
        </div>
    </div>
</div>

<div class="chart-container">
    <div class="chart">
        <h3>测试失败分布</h3>
        {% if failure_chart %}
        <img src="{{ static_url }}/{{ failure_chart }}" alt="测试失败分布图">
        {% else %}
        <p>图表生成失败或无失败数据</p>
        {% endif %}
    </div>
    <div class="chart">
        <h3>代码覆盖率</h3>
        {% if coverage_chart %}
        <img src="{{ static_url }}/{{ coverage_chart }}" alt="代码覆盖率图">
        {% else %}
        <p>图表生成失败或无覆盖率数据</p>
        {% endif %}
    </div>
</div>

<div class="details-section">
    <h2>单元测试结果</h2>
    <table>
        <tr>
            <th>总测试数</th>
            <th>通过</th>
            <th>失败</th>
            <th>跳过</th>
            <th>通过率</th>
        </tr>
        <tr>
            <td>{{ unit_tests.total }}</td>
            <td>{{ unit_tests.passed }}</td>
            <td>{{ unit_tests.failed }}</td>
            <td>{{ unit_tests.skipped }}</td>
            <td>{{ unit_tests.success_rate }}%</td>
        </tr>
    </table>
</div>

<div class="details-section">
    <h2>压力测试结果</h2>
    <table>
        <tr>
            <th>测试类型</th>
            <th>成功率</th>
            <th>最大负载</th>
            <th>恢复成功率</th>
        </tr>
        <tr>
            <td>内存压力测试</td>
            <td>{{ stress_tests.memory_tests.success_rate }}%</td>
            <td>{{ stress_tests.memory_tests.max_memory }} MB</td>
            <td>{{ stress_tests.recovery_success }}%</td>
        </tr>
        <tr>
            <td>并行处理测试</td>
            <td>{{ stress_tests.parallel_tests.success_rate }}%</td>
            <td>{{ stress_tests.parallel_tests.max_concurrent }} 任务</td>
            <td>-</td>
        </tr>
    </table>
</div>

<div class="details-section">
    <h2>隐私与合规测试结果</h2>
    <table>
        <tr>
            <th>测试类型</th>
            <th>测试用例</th>
            <th>通过率</th>
            <th>检测准确度</th>
        </tr>
        <tr>
            <td>隐私数据检测</td>
            <td>{{ privacy_tests.test_cases.total }}</td>
            <td>{{ privacy_tests.success_rate }}%</td>
            <td>{{ privacy_tests.pii_detection.detection_rate }}%</td>
        </tr>
        <tr>
            <td>法律合规性</td>
            <td>{{ legal_tests.test_cases.total }}</td>
            <td>{{ legal_tests.success_rate }}%</td>
            <td>{{ legal_tests.watermark_detection.detection_rate }}%</td>
        </tr>
    </table>
</div>

<div class="details-section">
    <h2>用户体验测试结果</h2>
    <table>
        <tr>
            <th>用户场景</th>
            <th>完成率</th>
            <th>状态</th>
        </tr>
        <tr>
            <td>新手用户</td>
            <td>{{ user_journey_tests.scenarios.beginner_user.completion_rate }}%</td>
            <td>
                <span class="status-label status-{{ 'passed' if user_journey_tests.scenarios.beginner_user.success else 'failed' }}">
                    {{ '通过' if user_journey_tests.scenarios.beginner_user.success else '失败' }}
                </span>
            </td>
        </tr>
        <tr>
            <td>老年用户</td>
            <td>{{ user_journey_tests.scenarios.elderly_user.completion_rate }}%</td>
            <td>
                <span class="status-label status-{{ 'passed' if user_journey_tests.scenarios.elderly_user.success else 'failed' }}">
                    {{ '通过' if user_journey_tests.scenarios.elderly_user.success else '失败' }}
                </span>
            </td>
        </tr>
        <tr>
            <td>专业用户</td>
            <td>{{ user_journey_tests.scenarios.professional_user.completion_rate }}%</td>
            <td>
                <span class="status-label status-{{ 'passed' if user_journey_tests.scenarios.professional_user.success else 'failed' }}">
                    {{ '通过' if user_journey_tests.scenarios.professional_user.success else '失败' }}
                </span>
            </td>
        </tr>
        <tr>
            <td>批量处理</td>
            <td>{{ user_journey_tests.scenarios.batch_processing.completion_rate }}%</td>
            <td>
                <span class="status-label status-{{ 'passed' if user_journey_tests.scenarios.batch_processing.success else 'failed' }}">
                    {{ '通过' if user_journey_tests.scenarios.batch_processing.success else '失败' }}
                </span>
            </td>
        </tr>
    </table>
</div>

<div class="details-section">
    <h2>代码覆盖率详情</h2>
    <table>
        <tr>
            <th>代码总行数</th>
            <th>覆盖行数</th>
            <th>覆盖率</th>
        </tr>
        <tr>
            <td>{{ coverage.total }}</td>
            <td>{{ coverage.covered }}</td>
            <td>{{ coverage.coverage_percent }}%</td>
        </tr>
    </table>

    <h3>模块覆盖率</h3>
    <table>
        <tr>
            <th>模块</th>
            <th>总行数</th>
            <th>覆盖行数</th>
            <th>覆盖率</th>
        </tr>
        {% for module, data in coverage.by_module.items() %}
        <tr>
            <td>{{ module }}</td>
            <td>{{ data.total }}</td>
            <td>{{ data.covered }}</td>
            <td>{{ data.coverage_percent }}%</td>
        </tr>
        {% endfor %}
    </table>
</div>
{% endblock %} 