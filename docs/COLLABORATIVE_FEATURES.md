# VisionAI-ClipsMaster 协作功能文档

## 概述

VisionAI-ClipsMaster 的协作功能允许多个用户同时协作编辑短剧混剪项目，提高团队工作效率。基于WebSocket实时通信和操作转换(OT)算法，确保所有用户的视图保持同步和一致。

## 主要功能

### 1. 实时批注

实时批注功能允许团队成员对剧本或视频片段添加评论和建议。批注会立即同步到所有协作者的界面上，便于团队讨论。

- **添加批注**: 选择视频或剧本的特定部分，点击"添加批注"按钮
- **查看批注**: 所有批注会显示在协作面板的批注列表中，包含作者、时间和内容信息
- **回复批注**: 可直接对已有批注进行回复，形成对话线程

### 2. 决策快照共享

决策快照功能允许保存项目在特定时间点的完整状态，便于团队成员查看和比较不同的创意方向。

- **创建快照**: 点击"创建快照"按钮，输入名称和描述
- **查看快照**: 在快照列表中选择要查看的快照
- **加载快照**: 点击快照项目中的"加载"按钮，将项目恢复到该快照状态
- **比较快照**: 选择两个快照进行并排比较，查看差异

### 3. 多视角同步

多视角同步功能可以让团队成员看到彼此在项目中的实时位置和操作，便于协调工作和减少冲突。

- **用户位置**: 在界面上以彩色标记显示其他用户的当前位置
- **编辑指示**: 当用户正在编辑某个部分时，其他用户会看到编辑指示
- **跟随模式**: 可以选择"跟随"特定用户，自动同步视图到该用户当前位置

## 使用方法

### 加入协作项目

1. 打开主界面，切换到右侧边栏的"协作"面板
2. 点击"加入项目"按钮
3. 输入项目ID或从最近项目列表中选择
4. 等待连接完成，协作面板将显示当前在线的其他用户

### 添加批注

1. 在视频时间轴或剧本编辑器中选择要批注的位置
2. 在协作面板的批注区域点击"添加批注"按钮
3. 输入批注内容并点击"发送"
4. 批注将立即同步到所有协作者的界面上

### 创建和使用快照

1. 点击协作面板中的"创建快照"按钮
2. 输入快照名称和描述
3. 点击"保存"按钮
4. 快照将显示在所有协作者的快照列表中
5. 要加载快照，点击快照项目中的"加载"按钮

### 查看其他用户活动

1. 当其他用户加入项目时，他们的用户标识将显示在"用户"区域
2. 用户标识的颜色表示其活跃状态(绿色=活跃，灰色=空闲)
3. 在剧本或时间轴中，可以看到其他用户的光标位置
4. 悬停在用户标识上可以查看其当前正在查看/编辑的内容

## 权限控制

协作系统支持基于角色的权限控制，确保项目安全：

- **查看权限**: 可以查看项目内容和批注，但不能进行编辑
- **编辑权限**: 可以查看和编辑项目内容，添加批注和快照
- **管理权限**: 可以管理用户权限，删除批注和快照

项目创建者默认拥有管理权限，可以在协作面板的"管理"标签中设置其他用户的权限。

## 冲突解决

当多个用户同时编辑同一内容时，系统使用操作转换(OT)算法自动解决冲突：

1. 系统接收所有用户的编辑操作
2. 使用时间戳和操作转换规则对操作进行排序和转换
3. 以确保所有用户最终看到相同的内容状态
4. 编辑冲突会以视觉提示的方式通知用户

## 离线支持

协作系统具有有限的离线支持功能：

1. 当网络连接中断时，用户可以继续在本地编辑项目
2. 系统将记录所有离线更改
3. 网络恢复后，系统将尝试同步更改(根据设置自动或手动)
4. 如果存在冲突，系统将提供解决选项

## 技术实现

协作功能基于以下关键技术实现：

- **WebSocket通信**: 提供低延迟的双向实时通信
- **操作转换算法**: 解决并发编辑冲突，确保数据一致性
- **JWT令牌认证**: 保证系统安全和用户身份验证
- **Redis发布/订阅**: 支持服务器端实时消息广播
- **增量更新**: 仅传输变更部分，提高性能和降低带宽占用

## 系统要求

协作功能需要以下系统支持：

- 网络连接(最低2Mbps上传和下载速度)
- 最低4GB系统内存(协作模式下的额外开销)
- 支持WebSocket的现代浏览器(如使用浏览器版本)
- 推荐使用有线网络连接以获得最佳性能

## 故障排除

如果遇到协作功能问题，请尝试以下步骤：

1. 检查网络连接
2. 重新加入项目
3. 刷新应用程序
4. 检查服务器状态指示器
5. 清除浏览器缓存(如使用浏览器版本)

如问题仍然存在，请查看日志文件(`logs/collaboration_*.log`)并联系技术支持。

---

版本: 1.0
更新日期: 2023-07-15 