# 文化语境验证器

## 概述

文化语境验证器是VisionAI-ClipsMaster的一个重要模块，专门用于验证视频场景中的文化元素是否符合特定时代和文化背景。该模块可以检测时代错误、文化混杂、文化禁忌违反等问题，并提供针对性的改进建议，帮助创作者构建文化上准确且尊重的内容。

## 主要功能

1. **时代文化一致性检查**：确保场景中的服饰、道具、语言等符合特定历史时期，避免出现时代错误。
2. **文化禁忌检测**：识别特定文化环境中不适宜的元素，避免文化冒犯。
3. **跨文化适配性分析**：评估内容在不同文化背景下的适应性。
4. **文化刻板印象检测**：识别和提示可能的文化刻板印象。
5. **历史准确性验证**：验证历史场景中的文化元素是否符合史实。
6. **文化建议生成**：为不同时代和文化背景的场景提供具体的改进建议。

## 核心类和接口

### 主要类

- **CulturalContextChecker**：文化上下文检查器，主要验证器类。
- **CulturalRuleDatabase**：文化规则数据库，管理和加载验证规则。
- **CulturalRule**：文化规则，定义特定文化上下文中的验证规则。

### 主要枚举

- **CulturalEra**：历史文化时代枚举，定义不同的历史时期。
- **CulturalRegion**：文化区域枚举，定义不同的文化地区。
- **CulturalErrorType**：文化错误类型枚举，定义不同类型的文化错误。

### 关键方法

- `validate_cultural_context()`：验证场景文化上下文的便捷函数。
- `analyze_cultural_accuracy()`：分析场景的文化准确性并返回详细报告。
- `validate_context()`：验证文化元素的准确性。
- `get_cultural_suggestions()`：获取文化适配建议。

## 使用示例

### 基本验证

```python
from src.logic.cultural_validator import validate_cultural_context

# 创建场景数据
scene = {
    "era": "中国古代",
    "region": "中国",
    "description": "一个古代中国的宫廷场景",
    "props": ["龙椅", "茶具", "玉玺"],
    "costumes": ["朝服", "官帽"]
}

# 验证场景
result = validate_cultural_context(scene)

# 检查结果
if result["is_accurate"]:
    print("场景文化验证通过")
else:
    print("检测到文化问题:")
    for error in result["errors"]:
        print(f"- {error['description']}")
    
    # 查看建议
    for suggestion in result["suggestions"]:
        print(f"建议: {suggestion}")
```

### 获取特定场景的文化建议

```python
from src.logic.cultural_validator import CulturalContextChecker

# 创建检查器
checker = CulturalContextChecker()

# 为特定时代场景获取建议
victorian_scene = {
    "era": "维多利亚时代",
    "region": "西欧"
}

suggestions = checker.get_cultural_suggestions(victorian_scene)
for suggestion in suggestions:
    print(suggestion)
```

## 时代和文化区域支持

### 支持的历史时代

- **史前时代** (10万年前-公元前3000年)
- **古代** (公元前3000年-公元476年)
- **中世纪** (476年-1453年)
- **文艺复兴** (1350年-1600年)
- **早期现代** (1600年-1760年)
- **工业时代** (1760年-1914年)
- **现代** (1914年-2000年)
- **当代** (2000年至今)

### 中国特定历史时期

- **中国古代** (夏商周-秦汉)
- **中国帝制时期** (秦汉-清朝)
- **民国时期** (1912年-1949年)
- **中国现代** (1949年至今)

### 特定时代

- **维多利亚时代** (1837年-1901年)
- **咆哮的二十年代** (1920年-1929年)
- **战后时期** (1945年-1970年)
- **数字时代** (1990年至今)

### 文化区域

- **东亚**：中国、日本、韩国等
- **南亚**：印度、巴基斯坦等
- **东南亚**：泰国、越南、印尼等
- **中东**：沙特、伊朗、土耳其等
- **非洲**：埃及、尼日利亚、肯尼亚等
- **欧洲**：英国、法国、德国等
- **北美**：美国、加拿大
- **拉丁美洲**：墨西哥、巴西、阿根廷等
- **大洋洲**：澳大利亚、新西兰等

## 文化错误类型

- **时代错误（ANACHRONISM）**：不符合特定历史时期的元素，如古代场景中出现现代科技。
- **文化混杂（CULTURAL_MIXING）**：不同文化元素不当混合，如服饰跨越不同时代和文化的混搭。
- **禁忌违反（TABOO_VIOLATION）**：触犯特定文化禁忌，如在伊斯兰场景中出现猪肉和酒精。
- **刻板印象（STEREOTYPE）**：强化文化刻板印象，如东方神秘主义的过度表现。
- **历史不准确（HISTORICAL_INACCURACY）**：与史实不符的描述或元素。
- **文化挪用（CULTURAL_APPROPRIATION）**：不当使用他文化元素，如将宗教符号作为时尚装饰。

## 验证场景数据格式

```json
{
    "era": "中国古代",         // 场景所属时代
    "region": "中国",          // 场景所属文化区域
    "description": "场景描述",  // 场景文本描述
    "props": [                // 场景中的道具列表
        "龙椅", 
        "茶具", 
        "玉玺"
    ],
    "costumes": [             // 场景中的服装列表
        "朝服", 
        "官帽", 
        "布鞋"
    ],
    "characters": [           // 场景中的角色列表
        "皇帝", 
        "大臣", 
        "侍女"
    ],
    "dialogue": "对话内容"      // 场景中的对话内容
}
```

## 自定义规则

可以通过创建JSON格式的规则文件来扩展验证规则：

```json
[
    {
        "id": "custom_rule_id",
        "name": "自定义规则名称",
        "description": "规则描述",
        "era": "VICTORIAN",
        "region": "WESTERN_EUROPE",
        "keywords": ["关键词1", "关键词2"],
        "forbidden_elements": ["禁止元素1", "禁止元素2"],
        "required_elements": ["必需元素1", "必需元素2"],
        "error_type": "ANACHRONISM"
    }
]
```

## 集成场景

- **历史题材视频验证**：检查历史影视作品中的时代准确性。
- **跨文化内容创作**：确保跨文化内容尊重并准确呈现不同文化。
- **教育内容验证**：验证教育视频中的历史和文化内容准确性。
- **广告文化适应**：帮助广告内容适应不同文化环境。
- **游戏和虚拟现实场景**：为游戏和VR场景提供文化准确性验证。

## 高级技巧

1. **时代嵌套处理**：对于有意混合不同时代元素的艺术创作，可以通过标记为"艺术风格"来避免错误报告。
2. **文化敏感度调节**：可以调整验证器的敏感度，以适应不同类型的内容创作。
3. **自定义文化规则**：针对特定项目创建自定义的文化规则集。
4. **多层级验证**：先进行粗略验证，然后针对特定场景进行深入验证。

## 常见问题

**Q: 如何处理故意的时代混搭艺术创作？**  
A: 可以在场景属性中添加`"artistic_style": true`标记，告知验证器这是有意的艺术创作。

**Q: 验证器是否支持非主流文化和小众文化？**  
A: 内置规则主要覆盖主要文化区域，但支持通过自定义规则文件添加更多细分文化的规则。

**Q: 如何避免文化刻板印象但又保持文化特征？**  
A: 建议参考验证器生成的建议，使用文化表示的平衡方法，既展示文化特色又避免过度简化。

**Q: 对于虚构世界中的文化表现如何验证？**  
A: 对于完全虚构的世界，可以将`"fictional_world": true`添加到场景数据中，验证器将放宽某些规则限制。

## 进一步阅读

- 请参考`examples/cultural_validator_demo.py`获取更多使用示例
- 查看单元测试`tests/test_cultural_validator.py`了解更多功能细节
- 尝试独立测试脚本`cultural_validator_standalone.py`快速体验功能 