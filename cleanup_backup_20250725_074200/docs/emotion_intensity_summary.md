# 情感强度图谱构建模块总结

## 模块概述

情感强度图谱构建模块是VisionAI-ClipsMaster中的关键功能模块，负责分析视频/剧本的情感变化曲线，识别情感高潮和低谷，并生成可视化图表。该模块为剧本重构和视频混剪提供情感分析依据，帮助提升视频的情感表达和叙事效果。

## 核心功能

- **情感强度分析**：分析文本内容的情感强度变化
- **情感曲线构建**：生成连续的情感强度曲线
- **峰值/低谷检测**：自动标记情感高潮和低谷点
- **情感质量评估**：评估情感流程的质量，检测潜在问题
- **可视化图表生成**：生成多种直观的情感分析图表
- **改进建议生成**：根据分析结果提供剧本优化建议

## 实现方式

模块使用多层次架构设计，确保功能的模块化和可扩展性：

1. **核心映射器层**：`EmotionMapper` 类实现情感曲线构建和分析
2. **可视化层**：`EmotionVisualizer` 类提供各种可视化功能
3. **配置管理层**：通过YAML配置文件管理参数和阈值
4. **示例与演示层**：提供示例脚本展示实际应用场景

## 核心算法

- **情感强度计算**：综合考虑文本情感词汇、标点符号、强调效果等因素
- **曲线平滑处理**：使用滑动窗口加权平均减少噪声
- **极值点检测**：相邻比较法识别情感曲线中的峰值和低谷
- **质量评估算法**：基于情感范围、转折点数量、高潮检测等多维度评分

## 配置系统

模块通过`configs/emotion_intensity.yaml`配置文件提供灵活的参数设置：

- 情感分析参数：情感阈值、标记权重等
- 平滑算法参数：窗口大小、权重分布等
- 极值检测参数：峰值/低谷阈值等
- 质量评估参数：各维度权重等
- 可视化参数：颜色方案、图表尺寸等

## 使用示例

```python
# 基本用法
from src.emotion.intensity_mapper import EmotionMapper
mapper = EmotionMapper()
curve_data = mapper.build_intensity_curve(scenes)
flow_analysis = mapper.analyze_emotion_flow(curve_data)

# 可视化
from src.emotion.visualizer import visualize_intensity_curve
visualize_intensity_curve(curve_data, output_dir="reports/emotion")
```

## 应用场景

1. **剧本重构前分析**：评估原始剧本的情感流程
2. **重构后质量验证**：验证重构剧本的情感质量
3. **混剪前情感映射**：为混剪提供情感参考
4. **情感节奏优化**：优化视频的情感节奏和高潮分布

## 输出示例

情感分析模块生成多种输出：

- **情感曲线图**：直观展示情感强度变化
- **情感热力图**：以热力图形式展示情感分布
- **交互式图表**：支持动态探索的HTML图表
- **JSON数据**：结构化的情感分析数据
- **评估报告**：质量评分和问题分析

## 实现挑战与解决方案

1. **中文情感分析挑战**：通过自定义情感词典提高中文文本分析准确性
2. **噪声敏感问题**：引入平滑算法减少情感曲线波动
3. **阈值参数调优**：基于测试数据集调整阈值参数
4. **个性化配置需求**：引入YAML配置文件实现灵活配置

## 集成点

该模块与其他模块的集成点：

- **与NLP模块**：利用情感分析器提供基础情感分析
- **与剧本重构模块**：提供情感流程分析输入
- **与沙盒验证模块**：作为剧本质量验证的一部分
- **与节奏调节模块**：为节奏调节提供情感基础

## 未来扩展

- **多模态情感分析**：结合音频/视觉信息进行更全面的情感分析
- **情感类型细分**：区分更多细分情感类型（恐惧、惊讶、期待等）
- **深度学习模型支持**：引入深度学习模型提高情感分析精度
- **情感流程模板**：提供不同类型内容的情感流程模板 