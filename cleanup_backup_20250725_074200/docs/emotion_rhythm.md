# 情感节奏调节器

情感节奏调节器是VisionAI-ClipsMaster中的核心组件，用于根据情感内容调整场景节奏，实现更具表现力的视听体验。

## 主要功能

1. **根据情感强度调整场景时长**：高情感强度的场景可以得到更多展示时间
2. **根据情感类型应用不同调整**：不同情感类型（如喜悦、悲伤、紧张等）采用不同的节奏策略
3. **保证情感连贯性**：确保相邻场景之间的节奏变化平滑，避免突变
4. **提供多种情感节奏模式**：支持渐强模式、波浪模式和焦点模式等多种情感节奏表达方式
5. **支持整个场景序列的处理**：保证整体节奏的连贯性和表现力

## 情感类型与节奏调整关系

不同情感类型会应用不同的节奏调整规则：

| 情感类型 | 调整因子 | 效果描述 |
|---------|---------|---------|
| 悲伤 | 1.2 | 延长场景，让观众有更多时间体验情感 |
| 喜悦 | 0.9 | 稍微加快节奏，传递愉悦感 |
| 紧张 | 0.8 | 明显加快节奏，增强紧张感 |
| 恐惧 | 0.85 | 加快节奏，增强不安感 |
| 愤怒 | 0.95 | 略微加快节奏，保持强度 |
| 惊讶 | 1.1 | 稍微延长，让观众有时间反应 |
| 中性 | 1.0 | 保持原始时长不变 |

## 情感强度与节奏关系

情感强度也会影响场景节奏：

- **高情感强度**（>0.8）：时长延长30%，突出重要情感
- **中情感强度**（0.4-0.8）：时长保持不变或小幅调整
- **低情感强度**（<0.4）：时长缩短30%，加快过渡

## 节奏模式

情感节奏调节器支持三种主要的节奏模式：

1. **情感渐强模式（emotional_crescendo）**：
   - 适用于情感逐渐增强的内容
   - 场景持续时间从短到长，突出高潮部分
   - 例如：悬疑片段、感人故事

2. **情感波浪模式（emotional_wave）**：
   - 适用于情感起伏的内容
   - 交替的快慢节奏，保持观众注意力
   - 例如：多情节交织的内容

3. **情感焦点模式（emotional_focus）**：
   - 突出高情感强度场景，其他场景加快
   - 明确的情感重点，周围内容服务于此
   - 例如：有明确高潮点的内容

## 使用方法

### 调整单个场景

```python
from src.emotion import EmotionRhythm, adjust_pacing

# 场景数据
scene = {
    "id": "悲伤场景",
    "text": "雨水打在窗户上，他静静地看着远方，眼中满是思念。",
    "start": 0.0,
    "end": 10.0,
    "emotion": {
        "type": "悲伤",
        "score": 0.85
    }
}

# 方法1：直接调用函数
adjusted_scene = adjust_pacing(scene)

# 方法2：使用调节器实例
rhythm_tuner = EmotionRhythm()
adjusted_scene = rhythm_tuner.adjust_pacing(scene)

# 获取调整后的持续时间
print(f"原始持续时间: {scene['end'] - scene['start']}秒")
print(f"调整后持续时间: {adjusted_scene['adjusted_duration']}秒")
print(f"调整因子: {adjusted_scene['timing_factor']}")
```

### 处理场景序列

```python
from src.emotion import EmotionRhythm, process_scene_sequence

# 场景序列
scenes = [
    {
        "id": "开场",
        "text": "平静的湖面反射着天空的蓝色。",
        "start": 0.0,
        "end": 8.0,
        "emotion": {"type": "中性", "score": 0.3}
    },
    {
        "id": "发现",
        "text": "主角突然看到水中有一个神秘物体！",
        "start": 8.0,
        "end": 12.0,
        "emotion": {"type": "惊讶", "score": 0.7}
    },
    # 更多场景...
]

# 方法1：自动选择节奏模式
adjusted_scenes = process_scene_sequence(scenes)

# 方法2：指定节奏模式
rhythm_tuner = EmotionRhythm()
adjusted_scenes = rhythm_tuner.process_scene_sequence(scenes, pattern="emotional_focus")

# 应用调整后的时长
for scene in adjusted_scenes:
    print(f"{scene['id']}: {scene['adjusted_duration']}秒")
```

## 配置定制

情感节奏调节器的配置可以通过修改`configs/emotion_rhythm.yaml`文件进行定制，主要配置项包括：

1. **情感强度调整参数**：调整不同强度范围的处理规则
2. **情感类型调整参数**：修改不同情感类型的调整因子
3. **连贯性参数**：控制场景间节奏变化的平滑度
4. **节奏模式参数**：定制各种节奏模式的表现
5. **场景约束**：设置最小和最大场景持续时间

例如，要调整"悲伤"类型的节奏因子：

```yaml
emotion_type_adjustment:
  悲伤: 1.3    # 从默认的1.2增加到1.3，进一步延长悲伤场景
```

## 与其他模块的集成

情感节奏调节器可以与VisionAI-ClipsMaster的其他模块无缝集成：

- **情感检测系统**：提供情感类型和强度输入
- **多模态情感共振**：优化情感表达的视听效果
- **情感焦点定位**：结合使用更精准标识情感重点
- **叙事结构优化**：结合故事结构调整节奏

## 示例和演示

可以查看`examples/emotion_rhythm_demo.py`了解更多使用示例，包括：

1. 单个场景的节奏调整演示
2. 不同情感类型的节奏处理对比
3. 多种节奏模式的效果展示
4. 情感连贯性处理的演示

## 技术实现

情感节奏调节器主要通过以下技术实现节奏调整：

1. **情感强度映射**：将情感强度映射到时长调整因子
2. **情感类型调整**：根据情感类型应用特定的调整规则
3. **连贯性算法**：确保相邻场景节奏变化平滑
4. **模式应用**：根据内容特点应用不同的节奏模式
5. **约束处理**：确保调整后的场景时长在合理范围内 