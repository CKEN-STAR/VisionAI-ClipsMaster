# 自动化环境检测系统

VisionAI-ClipsMaster 包含一个先进的自动环境检测系统，用于识别运行环境并优化应用性能。

## 功能特点

- **自动硬件识别**: 自动检测CPU、GPU、内存和存储空间
- **操作系统兼容性检查**: 验证当前系统是否支持所有功能
- **自适应配置**: 根据检测到的硬件自动调整应用设置
- **性能预测**: 估算在当前硬件上的预期性能
- **多平台支持**: 支持 Windows、macOS 和 Linux 系统

## 使用方法

### 命令行检测

直接使用命令行工具检查您的环境:

```bash
# 基本检测
python tests/device_compatibility/check_environment.py

# 显示详细信息
python tests/device_compatibility/check_environment.py --verbose

# 保存报告到文件
python tests/device_compatibility/check_environment.py --save
```

### 应用内检测

在主应用中启用环境检测:

```bash
# 显示设备信息
python app.py --device-info

# 检查环境兼容性
python app.py --check-environment
```

## 检测的指标

环境检测系统会检查以下指标:

| 指标 | 说明 | 用途 |
|------|------|------|
| CPU | 处理器型号和核心数 | 决定处理能力和线程数 |
| GPU | 显卡型号及是否支持加速 | 判断是否启用GPU加速 |
| 内存 | 系统总内存和可用内存 | 决定模型大小和批处理量 |
| 存储空间 | 磁盘总容量和可用空间 | 确保有足够空间存储模型和输出 |
| 操作系统 | 系统类型和版本 | 检查平台兼容性 |
| 网络连接 | 是否连接到互联网 | 判断是否可下载模型或更新 |

## 设备等级

系统会根据检测结果将设备分为四个等级:

1. **入门级 (Entry)**: 4GB内存，无GPU
   - 支持基本视频处理
   - 限制性能和批量处理能力

2. **中端 (Mid)**: 8GB内存，有/无GPU
   - 支持1080p视频处理
   - 有限的批处理能力
   - 支持多语言处理

3. **高端 (High)**: 16GB内存，有GPU
   - 支持2K/4K视频处理
   - 良好的批处理能力
   - 支持所有功能但可能有一定限制

4. **顶级 (Premium)**: 32GB+内存，高端GPU
   - 支持4K+视频处理
   - 全速批处理
   - 支持所有高级功能，无限制

## 自适应配置

环境检测系统会根据检测结果自动调整以下配置:

- **模型选择**: 对于低内存设备使用轻量级模型
- **量化设置**: 在内存受限时启用模型量化
- **批处理大小**: 根据可用内存和GPU调整
- **线程数**: 基于CPU核心数优化
- **预览质量**: 根据设备能力调整视频预览质量
- **内存限制**: 控制应用最大内存使用量

## 系统架构

环境检测系统由以下组件组成:

1. `device_detector.py`: 底层硬件检测组件
2. `environment_manager.py`: 环境管理和配置生成器
3. `device_matrix.py`: 兼容性定义和功能要求矩阵
4. `check_environment.py`: 便捷的检测工具

## 扩展和自定义

开发者可以通过以下方式扩展环境检测系统:

1. 修改 `device_matrix.py` 中的兼容性矩阵
2. 在 `environment_manager.py` 中添加新的配置生成逻辑
3. 扩展 `device_detector.py` 以检测更多硬件指标

## 故障排除

如果环境检测系统无法正确识别您的硬件:

1. 尝试使用 `--verbose` 选项获取更详细的信息
2. 检查日志文件 `visionai_clips.log` 中的警告信息
3. 手动编辑 `~/.visionai/config/environment.json` 文件

## 示例输出

```
===============================================================
VisionAI-ClipsMaster 环境兼容性报告
===============================================================

📊 设备摘要: 高端设备 - CPU: 11th Gen Intel(R) Core(TM) i7-11800H, RAM: 32.0GB, GPU: NVIDIA GeForce RTX 3070

🖥️  硬件信息:
  CPU: 11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz
  GPU: NVIDIA GeForce RTX 3070
  内存: 32.00 GB
  磁盘可用空间: 342.56 GB

💻 操作系统: Windows-10-10.0.22621-SP0
  Python版本: 3.10.11

📱 设备等级: 高端

✅ 功能支持状态:
  基本视频处理: ✓ 支持
  4K视频处理: ✓ 支持
  实时视频增强: ✓ 支持
  批量处理: ✓ 支持
  多语言支持: ✓ 支持

⚡ 预期性能:
  处理速度: 2x实时
  最大分辨率: 4K
  并发任务数: 4

----------------------------------------------------------------------
✅ 结论: 当前设备完全适合运行VisionAI-ClipsMaster的所有功能。
=============================================================== 